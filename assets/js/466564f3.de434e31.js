"use strict";(self.webpackChunkgrid_docs=self.webpackChunkgrid_docs||[]).push([[4609],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return d}});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,u=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=l(r),d=i,h=m["".concat(u,".").concat(d)]||m[d]||c[d]||a;return r?n.createElement(h,s(s({ref:t},p),{},{components:r})):n.createElement(h,s({ref:t},p))}));function d(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,s=new Array(a);s[0]=m;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var l=2;l<a;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},43:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return o},contentTitle:function(){return u},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var n=r(7462),i=r(3366),a=(r(7294),r(3905)),s=["components"],o={title:"Auto-Resume Experiments",sidebar_label:"Auto-Resume Experiments"},u="Auto Resume Experiments",l={unversionedId:"features/runs/Creating Runs/Adv Runs/auto-resume-experiments",id:"features/runs/Creating Runs/Adv Runs/auto-resume-experiments",title:"Auto-Resume Experiments",description:"What are resumable experiments?",source:"@site/docs/features/runs/1_Creating Runs/2_Adv Runs/5_auto-resume-experiments.md",sourceDirName:"features/runs/1_Creating Runs/2_Adv Runs",slug:"/features/runs/Creating Runs/Adv Runs/auto-resume-experiments",permalink:"/features/runs/Creating Runs/Adv Runs/auto-resume-experiments",editUrl:"https://github.com/gridai/grid-docs/edit/master/docs/features/runs/1_Creating Runs/2_Adv Runs/5_auto-resume-experiments.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Auto-Resume Experiments",sidebar_label:"Auto-Resume Experiments"},sidebar:"tutorialSidebar",previous:{title:"Spot Instances",permalink:"/features/runs/Creating Runs/Adv Runs/interruptible-machines"},next:{title:"GitHub Integration",permalink:"/features/runs/private-repos"}},p=[{value:"What are resumable experiments?",id:"what-are-resumable-experiments",children:[],level:3},{value:"Gotchas",id:"gotchas",children:[],level:3},{value:"How to use it?",id:"how-to-use-it",children:[{value:"Prerequisites",id:"prerequisites",children:[],level:4},{value:"UI",id:"ui",children:[],level:4},{value:"CLI",id:"cli",children:[],level:4}],level:3},{value:"PyTorch Lightning Fault Tolerance",id:"pytorch-lightning-fault-tolerance",children:[],level:3}],c={toc:p};function m(e){var t=e.components,r=(0,i.Z)(e,s);return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"auto-resume-experiments"},"Auto Resume Experiments"),(0,a.kt)("h3",{id:"what-are-resumable-experiments"},"What are resumable experiments?"),(0,a.kt)("p",null,"When running experiments on interruptible spot instances, Grid can automatically resume your experiment from the last saved checkpoint when a new instance becomes available. Grid will also recover all artifacts, including the last saved checkpoints. The local filesystem will be preserved between experiment interruption and experiment resumption."),(0,a.kt)("p",null,"PyTorch Lightning offers out-of-the-box fault-tolerant training, which will automatically preserve any mid-epoch progress. ",(0,a.kt)("strong",{parentName:"p"},"When not using PyTorch Lightning, you will need to make sure your script is resumable.")),(0,a.kt)("p",null,"The lifecycle of a resumable experiment is as follows:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Experiment starts running"),(0,a.kt)("li",{parentName:"ul"},"Experiment trains happily :). But, alas, it is getting terminated soon. Danger on the horizon!"),(0,a.kt)("li",{parentName:"ul"},"Grid receives a notification of pending interruption. It will send your experiment process Linux signal SIGTERM"),(0,a.kt)("li",{parentName:"ul"},"Your process is expected to terminate orderly, that is dump checkpoints/any state to disk, and exit with status code 0"),(0,a.kt)("li",{parentName:"ul"},"Grid will automatically reschedule your experiment on a different instance, albeit it may take a while until a new preemptible/spot instance is available"),(0,a.kt)("li",{parentName:"ul"},"New preemptible/spot instance is booted, and we schedule your experiment on it"),(0,a.kt)("li",{parentName:"ul"},"Before your experiment begins Grid resumes any artifacts (including your last checkpoint)"),(0,a.kt)("li",{parentName:"ul"},"We resume your experiment with the same run command")),(0,a.kt)("h3",{id:"gotchas"},"Gotchas"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Multi-node experiments currently are not supported"),(0,a.kt)("li",{parentName:"ul"},"Filesystem is partially preserved, only the experiment execution directory is preserved; similarly as artifacts")),(0,a.kt)("h3",{id:"how-to-use-it"},"How to use it?"),(0,a.kt)("h4",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"In order for experiments to resume from last checkpoint, the following prerequisites must be met:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"On interruption the process shall receive signal SIGTERM"),(0,a.kt)("li",{parentName:"ul"},"The process needs to save checkpoint and exit with status code 0"),(0,a.kt)("li",{parentName:"ul"},"On resuming we'll restore all artifacts and code is responsible for resuming from last checkpoint in the file system")),(0,a.kt)("h4",{id:"ui"},"UI"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/13732925/148102089-f540356a-a2e6-4e9d-ac1f-51de26691086.png",alt:"image"})),(0,a.kt)("h4",{id:"cli"},"CLI"),(0,a.kt)("p",null,"Use ",(0,a.kt)("inlineCode",{parentName:"p"},"--auto_resume")," flag to indicate this experiment is safe to resume."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grid run --use_spot --auto_resume --instance_type p3.2xlarge mnist.py\n")),(0,a.kt)("h3",{id:"pytorch-lightning-fault-tolerance"},"PyTorch Lightning Fault Tolerance"),(0,a.kt)("p",null,"PyTorch Lightning provides a built-in auto-resume mechanism. This would enable you to run your experiments at the cheapest cost without worrying about your experiments being terminated before they should be.  "),(0,a.kt)("p",null,"You can learn more about the PyTorch Lightning Fault Tolerance mechanism ",(0,a.kt)("a",{parentName:"p",href:"https://pytorch-lightning.readthedocs.io/en/latest/advanced/fault_tolerant_training.html#:~:text=Fault%2Dtolerant%20Training%20is%20an,a%20hardware%20or%20software%20failure.&text=fit()%20fails%20in%20the,and%20everything%20will%20be%20restored."},"here"),"."),(0,a.kt)("p",null,"Furthermore, PyTorch Lightning provides a reproducible script that you can find ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pl_examples/fault_tolerant/automatic.py"},"here")," which is tested end-to-end on Grid with the Auto-Resume feature and can be used as a reference for you to get started."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"If you have additional questions about Runs, visit the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.grid.ai/features/runs/faq"},"FAQ"),". The section is periodically updated this with common questions from the Grid community."))))}m.isMDXComponent=!0}}]);