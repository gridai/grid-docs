"use strict";(self.webpackChunkgrid_docs=self.webpackChunkgrid_docs||[]).push([[9911],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),u=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(t),m=i,g=d["".concat(l,".").concat(m)]||d[m]||c[m]||r;return t?a.createElement(g,o(o({ref:n},p),{},{components:t})):a.createElement(g,o({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var u=2;u<r;u++)o[u]=t[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7577:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return p},toc:function(){return c},default:function(){return g}});var a,i=t(7462),r=t(3366),o=(t(7294),t(3905)),s=["components"],l={title:"Creating Runs from Config File",sidebar_label:"Creating Runs from Config File"},u=void 0,p={unversionedId:"features/runs/Creating Runs/Adv Runs/creating-runs-from-config",id:"features/runs/Creating Runs/Adv Runs/creating-runs-from-config",title:"Creating Runs from Config File",description:"The following examples assume you have already installed and setup Grid. If you haven't, please visit the Getting Started page.",source:"@site/docs/features/runs/1_Creating Runs/2_Adv Runs/3_creating-runs-from-config.md",sourceDirName:"features/runs/1_Creating Runs/2_Adv Runs",slug:"/features/runs/Creating Runs/Adv Runs/creating-runs-from-config",permalink:"/features/runs/Creating Runs/Adv Runs/creating-runs-from-config",editUrl:"https://github.com/gridai/grid-docs/edit/master/docs/features/runs/1_Creating Runs/2_Adv Runs/3_creating-runs-from-config.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Creating Runs from Config File",sidebar_label:"Creating Runs from Config File"},sidebar:"tutorialSidebar",previous:{title:"Creating Runs from Dockerfile",permalink:"/features/runs/Creating Runs/Adv Runs/creating-runs-with-dockerfile"},next:{title:"Spot Instances",permalink:"/features/runs/Creating Runs/Adv Runs/interruptible-machines"}},c=[{value:"Creating Runs With a Config File",id:"creating-runs-with-a-config-file",children:[],level:2},{value:"Grid Spec Overview",id:"grid-spec-overview",children:[],level:2},{value:"Config Files with Actions",id:"config-files-with-actions",children:[],level:2},{value:"Available Actions",id:"available-actions",children:[{value:"on_build_start",id:"on_build_start",children:[],level:3},{value:"on_build_end",id:"on_build_end",children:[],level:3},{value:"on_exeperiment_start",id:"on_exeperiment_start",children:[],level:3},{value:"on_experiment_end",id:"on_experiment_end",children:[],level:3}],level:2},{value:"Configuring Actions",id:"configuring-actions",children:[{value:"Environment variable substitution",id:"environment-variable-substitution",children:[],level:3},{value:"Default environment variables",id:"default-environment-variables",children:[],level:3},{value:"String operations",id:"string-operations",children:[],level:3}],level:2}],d=(a="Note",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",e)}),m={toc:c};function g(e){var n=e.components,t=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,i.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The following examples assume you have already installed and setup Grid. If you haven't, please visit the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.grid.ai/getting-started"},"Getting Started")," page."))),(0,o.kt)("h1",{id:"using-yaml"},"Using YAML"),(0,o.kt)("p",null,"In addition to CLI parameters, Grid supports the use of YML files for passing configuration properties to a Grid Run. This eliminates the need to specify a long list of parameters at the command-line during frequent Run iterations. If compute parameters do not change often, we suggest you create a Grid config file and use that instead of specifying parameters at the command-line."),(0,o.kt)("h2",{id:"creating-runs-with-a-config-file"},"Creating Runs With a Config File"),(0,o.kt)("p",null,"You can create a Run with a config file instead of passing CLI arguments. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"grid run --config my_config.yml script.py\n")),(0,o.kt)("h2",{id:"grid-spec-overview"},"Grid Spec Overview"),(0,o.kt)("p",null,"The following YML file contains a commented version of every YML key. You need to provide these keys when writing a config file and change the properties to what you need."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Use either ",(0,o.kt)("a",{parentName:"p",href:"../../../platform/custom-cloud-credentials/grid-cluster-context.md"},"cluster context")," or make sure to place your cluster ID in the ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster")," field, replacing the ",(0,o.kt)("strong",{parentName:"p"},"XXXXXX")," placeholder."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'# Main compute configuration.\ncompute:\n\n  # Add cloud configuration here.\n  provider:\n\n    cluster: XXXXXX           # Cluster ID\n\n  # Training configuration.\n  train:\n\n    cpus: 1                       # Number of CPUs\n    gpus: 0                       # Number of GPUs\n    instance: t2.xlarge           # AWS instance type\n    datastore_name: null          # Datastore name to use\n    datastore_version: null       # Datastore version number\n    datastore_mount_dir: null     # Where to mount the datastore\n    use_spot: false               # If we should use spot instances\n    framework: "lightning"        # Which framework to use\n\n    # Pass in environment variables\n    environment:                \n      MY_ENVIRONMENT_VARIABLE: "example"\n')),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Flags in grid YML files have a 1-1 mapping with ",(0,o.kt)("inlineCode",{parentName:"p"},"grid run")," flags"))),(0,o.kt)("h2",{id:"config-files-with-actions"},"Config Files with Actions"),(0,o.kt)("p",null,"Config files also allow the use of a special feature called Actions. Grid Actions give you the flexibility of adding steps to your training workflow without having to change your training script."),(0,o.kt)("p",null,"Example uses of Actions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Installing libraries like Apex"),(0,o.kt)("li",{parentName:"ul"},"Downloading data"),(0,o.kt)("li",{parentName:"ul"},"Processing something"),(0,o.kt)("li",{parentName:"ul"},"...")),(0,o.kt)("h2",{id:"available-actions"},"Available Actions"),(0,o.kt)("h3",{id:"on_build_start"},"on","_","build","_","start"),(0,o.kt)("p",null,"These are executed as your Run's image is built. We cache these commands on every git SHA. This is useful for installing dependencies and other system setup tasks."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"compute:\n  train:\n\n    actions:\n      on_build_start:\n        - apt-get install wget -y\n        - pip install tqdm\n")),(0,o.kt)("h3",{id:"on_build_end"},"on","_","build","_","end"),(0,o.kt)("p",null,"These are executed as at the end of building Run's image."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"compute:\n  train:\n\n    actions:\n      on_build_end:\n        - apt update\n")),(0,o.kt)(d,{mdxType:"Note"}," Commands automatically run as sudo "),(0,o.kt)("h3",{id:"on_exeperiment_start"},"on","_","exeperiment","_","start"),(0,o.kt)("p",null,"Arbitrary commands that run just before your training process starts. This is useful for downloading and preparing data, etc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"compute:\n  train:\n\n    actions:\n      on_experiment_start:\n        - bash download_dataset.sh\n")),(0,o.kt)("h3",{id:"on_experiment_end"},"on","_","experiment","_","end"),(0,o.kt)("p",null,"Runs after your script stops. This is useful for post-processing data, sending alerts and notifications to your systems, etc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"compute:\n  train:\n\n    actions:\n      on_experiment_end:\n        - apt-get install curl -y\n        - curl -X GET http://webhook.com?success=true\n")),(0,o.kt)("h2",{id:"configuring-actions"},"Configuring Actions"),(0,o.kt)("p",null,"You can configure Grid Actions by using a Grid config file ","(","see details on ",(0,o.kt)("a",{parentName:"p",href:"./17_yaml-configs/2_yaml-api.md"},"Grid YML",")"),"."),(0,o.kt)("p",null,"Here's a full example of a Grid configuration using actions:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"compute:\n  provider:\n    credentials: cc-wv4l9\n    region: us-east-1\n    vendor: aws\n\n  train:\n    cpus: 1\n    gpus: 0\n    instance: t2.xlarge\n\n    # Actions need to be passed as one command\n    # per line.\n    actions:\n      on_build_start:\n        - apt-get install wget -y\n        - pip install tqdm\n\n      on_experiment_start:\n        - bash download_dataset.sh\n\n      on_experiment_end:\n        - apt-get install curl -y\n        - curl -X GET http://webhook.com?success=true\n")),(0,o.kt)("p",null,"As you can see, you can pass one command per line. You can pass as many commands as you'd like."),(0,o.kt)("h3",{id:"environment-variable-substitution"},"Environment variable substitution"),(0,o.kt)("p",null,"Grid allows environment variable substitution for ",(0,o.kt)("inlineCode",{parentName:"p"},"on_experiment_start")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"on_experiment_end")," actions. All declared environment variables for the run are available in the substitution ","(","as well as some Grid predefined variables",")",". Example config:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'compute:\n\n  train:\n    cpus: 1\n    gpus: 0\n    instance: t2.medium\n    framework: lightning\n\n    environment:\n      WEBHOOK_URL: https://hooks.example.com/grid\n\n    # Actions need to be passed as one command\n    # per line.\n    actions:\n      on_build_start:\n        - apt-get update\n        - apt-get install curl -y\n      on_experiment_start:\n        - bash before.sh\n\n      on_experiment_end:\n        - |\n            curl -X POST -d \'{"name": "${GRID_EXPERIMENT_ID}", "instance_type": "${GRID_INSTANCE_TYPE}", "status": "status", "step": "after"}\' ${WEBHOOK_URL}\n\n')),(0,o.kt)("h3",{id:"default-environment-variables"},"Default environment variables"),(0,o.kt)("p",null,"Grid sets several environment variables by default for all experiments:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GRID","_","EXPERIMENT","_","ID")," - experiment's ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GRID","_","EXPERIMENT","_","NAME")," - experiment name"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GRID","_","USER","_","ID")," - ID of the user who created the experiment"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GRID","_","CLUSTER","_","ID")," - ID of the cluster where experiment is running"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GRID","_","INSTANCE","_","TYPE")," - machine type ","(",(0,o.kt)("em",{parentName:"li"},"t2.medium,")," ",(0,o.kt)("em",{parentName:"li"},"g4dn.xlarge,")," etc.",")")),(0,o.kt)("h3",{id:"string-operations"},"String operations"),(0,o.kt)("p",null,"Grid provides partial emulation for bash string operations. This can be used to manipulate string values prior to substitution."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Example variable substitution with substring:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"on_experiment_end:\n- |\n    echo ${GRID_EXPERIMENT_ID:0:4} # Getting first 4 symbols\n\n")),(0,o.kt)("p",null,"Grid emulates the below string operations:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"${parameter^}\n${parameter^^}\n${parameter,}\n${parameter,,}\n${parameter:position}\n${parameter:position:length}\n${parameter#substring}\n${parameter##substring}\n${parameter%substring}\n${parameter%%substring}\n${parameter/substring/replacement}\n${parameter//substring/replacement}\n${parameter/#substring/replacement}\n${parameter/%substring/replacement}\n${#parameter}\n${parameter=default}\n${parameter:=default}\n${parameter:-default}\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If you have additional questions about Runs, visit the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.grid.ai/features/runs/faq"},"FAQ"),". The section is periodically updated this with common questions from the Grid community."))))}g.isMDXComponent=!0}}]);